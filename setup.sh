#!/bin/bash

# Функция для логирования
log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1"
}

# Проверка наличия Python
if ! command -v python3 &> /dev/null; then
    log "Ошибка: python3 не установлен!"
    exit 1
fi

# Проверка наличия pip
if ! command -v pip3 &> /dev/null; then
    log "Ошибка: pip3 не установлен!"
    exit 1
fi

# Создание виртуального окружения если его нет
if [ ! -d "venv" ]; then
    log "Создание виртуального окружения..."
    python3 -m venv venv
fi

# Активация виртуального окружения
log "Активация виртуального окружения..."
source venv/bin/activate

# Установка зависимостей
log "Установка зависимостей..."
pip install -r requirements.txt

# Создание .env файла если его нет
if [ ! -f ".env" ]; then
    log "Создание .env файла..."
    cp env.example .env
    echo "⚠️ Создан файл .env, не забудьте заполнить его правильными значениями!"
fi

# Создание необходимых директорий
log "Создание необходимых директорий..."
mkdir -p logs
mkdir -p stats

# Установка прав доступа
log "Установка прав доступа..."
chmod +x *.sh

log "Установка завершена успешно!"
log "Теперь выполните следующие действия:"
log "1. Отредактируйте файл .env и добавьте необходимые ключи API"
log "2. Запустите бота командой ./run.sh"
